<!doctype html>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<style>
#container {
	min-width: 310px;
	max-width: 800px;
	height: 400px;
	margin: 0 auto
}
#container2 {
	min-width: 310px;
	max-width: 800px;
	height: 400px;
	margin: 0 auto
}
</style>
<div id="prContainer"></div>
<div id="linesContainer"></div>
<div id="issueContainer"></div>

<script>
d3.csv("smarthomeStats.csv", function(error, data) {
	//Timespan,IssuesNew,IssuesClosed,PRsNew,PRsMerged,LinesAdded,LinesDeleted
	var timespan = data.map(function(item){
		return item.Timespan
	})

	//prs
	var prsNew = data.map(function(item){
		return parseInt(item['PRsNew'], 10)
	})	
	var prsMerged = data.map(function(item){
		return parseInt(item['PRsMerged'], 10)
	})

	//lines
	var linedAdded = data.map(function(item){
		return parseInt(item['LinesAdded'], 10)
	})	
	var linesDeleted = data.map(function(item){
		return parseInt(item['LinesDeleted'], 10)
	})
	
	//issues
	var issuesNew = data.map(function(item){
		return parseInt(item['IssuesNew'], 10)
	})	
	var issuesClosed = data.map(function(item){
		return parseInt(item['IssuesClosed'], 10)
	})

	var prSeries = [{name: "New", data: prsNew}, {name: "Merged", data: prsMerged}]
	createChart("prContainer", "Pull requests", timespan, prSeries)

	var linesSeries = [{name: "Added Lines", data: linedAdded}, {name: "Deleted Lines", data: linesDeleted}]
	createChart("linesContainer", "Code Base", timespan, linesSeries)
	
	var issueSeries = [{name: "New", data: issuesNew}, {name: "Closed", data: issuesClosed}]
	createChart("issueContainer", "Issues", timespan, issueSeries)
});

function createChart(container, title, categories, series) {
	Highcharts.chart(container, {
		chart: {
			type: 'column',
		},
        
		yAxis: {
			title: {
				text: 'Number'
			}
		},
		xAxis: {
			categories: categories
		},

		title: {
            text: title
        },

		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'middle'
		},

		series: series
	});
}
</script>
